---
import '../../styles/global.css';
import { getCollection } from 'astro:content';
import { footerContent } from '../../../../shared/footer-content.js';

const blogEntries = await getCollection('blog');
// Sort by date, newest first
blogEntries.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

// Map to include category info from blogPosts.js
const postsWithMeta = blogEntries.map(entry => {
  const slug = entry.slug;
  let category = 'Guides';
  let emoji = 'üìù';
  let readTime = 5;

  if (slug.includes('dumbbells') || slug.includes('blender')) {
    category = 'Gear Reviews';
    emoji = slug.includes('advanced') ? 'üí™' : 'üèãÔ∏è';
  } else if (slug.includes('calculator') || slug.includes('tdee')) {
    category = 'Calculators';
    emoji = 'üßÆ';
  } else if (slug === 'what-are-calories') {
    emoji = '‚ö°';
  } else if (slug === 'what-are-macros') {
    emoji = 'üçé';
  } else if (slug === 'how-to-calculate-tdee') {
    emoji = 'üî•';
    category = 'Calculators';
    readTime = 7;
  } else if (slug === 'best-blenders-for-protein-shakes') {
    emoji = 'ü´ê';
    readTime = 6;
  } else if (slug === 'macro-calculator-guide') {
    readTime = 6;
  }

  return { ...entry, category, emoji, readTime };
});
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog - Guides, Calculators & Gear Reviews - Free Calorie Track</title>
  <meta name="description" content="Free guides on calorie tracking, macros, TDEE, and honest reviews of fitness gear including blenders and adjustable dumbbells.">
  <link rel="canonical" href="https://freecalorietrack.com/blog/">

  <!-- Favicon - FCT logo -->
  <link rel="icon" href="/favicon.ico?v=6">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png?v=6">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Blog - Free Calorie Track">
  <meta property="og:description" content="Free guides on calorie tracking, macros, TDEE, and honest reviews of fitness gear.">
  <meta property="og:url" content="https://freecalorietrack.com/blog/">

  <!-- Fonts - match main app -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Dark mode initialization script -->
  <script is:inline>
    if (localStorage.getItem('darkMode') === 'true') {
      document.documentElement.classList.add('dark');
    }
  </script>

</head>
<body class="min-h-screen flex flex-col bg-white dark:bg-gray-900">
  <!-- Skip to main content link for keyboard navigation -->
  <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-emerald-600 focus:text-white focus:rounded">
    Skip to main content
  </a>

  <!-- Header -->
  <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700" role="banner">
    <div class="max-w-4xl mx-auto px-4 py-6">
      <a href="/" class="text-sm text-gray-500 dark:text-gray-400 hover:text-emerald-600 dark:hover:text-emerald-400 mb-2 inline-block" aria-label="Return to Free Calorie Track app">
        ‚Üê Back to App
      </a>
      <a href="/blog">
        <div class="text-3xl font-bold" style="font-family: 'Inter', system-ui, sans-serif; letter-spacing: -0.02em;">
          <span class="text-emerald-600 dark:text-emerald-400">Free Calorie Track</span>
          <span class="text-gray-600 dark:text-gray-400"> Blog</span>
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1" style="font-family: 'Inter', system-ui, sans-serif;">
          Calorie tracking tips, gear reviews, and guides
        </p>
      </a>
    </div>
  </header>

  <!-- Main Content -->
  <main id="main-content" class="flex-1 max-w-4xl mx-auto px-4 py-8 w-full" role="main">
    <!-- Categories -->
    <h2 class="sr-only">Filter Articles</h2>
    <div class="mb-8 flex flex-wrap gap-3" role="group" aria-label="Filter articles by category">
      <button
        type="button"
        class="category-filter px-4 py-2 rounded-full text-sm font-medium transition-colors bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400"
        data-category="All"
        aria-pressed="true"
        aria-label="Show all articles"
      >
        All
      </button>
      <button
        type="button"
        class="category-filter px-4 py-2 rounded-full text-sm font-medium transition-colors bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"
        data-category="Guides"
        aria-pressed="false"
        aria-label="Show guides only"
      >
        Guides
      </button>
      <button
        type="button"
        class="category-filter px-4 py-2 rounded-full text-sm font-medium transition-colors bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"
        data-category="Gear Reviews"
        aria-pressed="false"
        aria-label="Show gear reviews only"
      >
        Gear Reviews
      </button>
      <button
        type="button"
        class="category-filter px-4 py-2 rounded-full text-sm font-medium transition-colors bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"
        data-category="Calculators"
        aria-pressed="false"
        aria-label="Show calculators only"
      >
        Calculators
      </button>
    </div>

    <!-- Screen reader announcement for filter changes -->
    <div id="filter-announcement" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>

    <!-- Posts Grid -->
    <div class="grid gap-8 md:grid-cols-2">
      {postsWithMeta.map((post) => (
        <a
          href={`/blog/${post.slug}`}
          data-category={post.category}
          class="blog-post-card group bg-white dark:bg-gray-800 rounded-xl shadow-md hover:shadow-xl transition-all overflow-hidden border border-gray-200 dark:border-gray-700"
          aria-label={`Read article: ${post.data.title}`}
        >
          <div class="aspect-video bg-gradient-to-br from-emerald-400 to-emerald-600 relative overflow-hidden" aria-hidden="true">
            {post.data.image ? (
              <img
                src={post.data.image}
                alt={post.data.title}
                class="w-full h-full object-cover"
                loading="lazy"
              />
            ) : (
              <div class="absolute inset-0 flex items-center justify-center">
                <span class="text-6xl">{post.emoji}</span>
              </div>
            )}
          </div>
          <div class="p-6">
            <div class="flex items-center gap-2 mb-3">
              <span class="text-xs font-semibold text-emerald-600 dark:text-emerald-400 uppercase tracking-wide">
                {post.category}
              </span>
              <span class="text-xs text-gray-500 dark:text-gray-400">‚Ä¢</span>
              <span class="text-xs text-gray-500 dark:text-gray-400">{post.readTime} min read</span>
            </div>
            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors" style="font-family: 'Inter', system-ui, sans-serif;">
              {post.data.title}
            </h2>
            <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed" style="font-family: 'Inter', system-ui, sans-serif;">
              {post.data.description}
            </p>
          </div>
        </a>
      ))}
    </div>
  </main>

  <!-- CTA Footer -->
  <div class="bg-emerald-50 dark:bg-emerald-900/20 border-t border-emerald-100 dark:border-emerald-800 py-12">
    <div class="max-w-4xl mx-auto px-4 text-center">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-3" style="font-family: 'Inter', system-ui, sans-serif;">
        Ready to Start Tracking?
      </h2>
      <p class="text-gray-700 dark:text-gray-300 mb-6" style="font-family: 'Inter', system-ui, sans-serif;">
        Free Calorie Track includes barcode scanning, macro tracking, trends, and offline mode‚Äîall free forever.
      </p>
      <a
        href="/"
        class="inline-block bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors shadow-lg"
        style="font-family: 'Inter', system-ui, sans-serif;"
      >
        Get Started Free
      </a>
    </div>
  </div>

  <!-- Footer - imported from shared content -->
  <footer class="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 py-12 px-4 mt-auto border-t border-gray-300 dark:border-gray-700">
    <div class="max-w-4xl mx-auto space-y-8">

      <!-- Medical Disclaimer -->
      <div class="bg-yellow-50 dark:bg-yellow-900/30 border-l-4 border-yellow-500 p-4 rounded">
        <h3 class="font-bold text-gray-900 dark:text-gray-100 mb-2">{footerContent.medicalDisclaimer.title}</h3>
        <p class="text-sm text-gray-700 dark:text-gray-300">{footerContent.medicalDisclaimer.text}</p>
      </div>

      <!-- Support Section -->
      <div class="text-center border-t border-gray-300 dark:border-gray-600 pt-6">
        <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-2">{footerContent.supportSection.heading}</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">{footerContent.supportSection.description}</p>
        <a
          href={footerContent.supportSection.buttonUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-block bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors"
        >
          {footerContent.supportSection.buttonText}
        </a>
      </div>

      <!-- Affiliate Gear Links -->
      <div class="border-t border-gray-300 dark:border-gray-600 pt-6">
        <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-3 text-center">{footerContent.gearLinks.heading}</h3>
        <p class="text-xs text-gray-500 dark:text-gray-400 text-center mb-4 italic">{footerContent.gearLinks.disclaimer}</p>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          {footerContent.gearLinks.items.map((link) => (
            <a
              href={link.url}
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center gap-2 p-3 bg-white dark:bg-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors border border-gray-200 dark:border-gray-600"
            >
              <span class="text-2xl">{link.emoji}</span>
              <span class="text-sm font-medium text-gray-800 dark:text-gray-200">{link.text}</span>
            </a>
          ))}
        </div>
      </div>

      <!-- Feedback Link -->
      <div class="text-center text-sm border-t border-gray-300 dark:border-gray-600 pt-6">
        <a
          href={footerContent.feedbackLink.url}
          target="_blank"
          rel="noopener noreferrer"
          class="text-emerald-600 dark:text-emerald-400 hover:underline"
        >
          {footerContent.feedbackLink.text}
        </a>
      </div>

      <!-- Legal Links -->
      <div class="flex justify-center gap-6 text-sm border-t border-gray-300 dark:border-gray-600 pt-6">
        {footerContent.legalLinks.map((link, index) => (
          <>
            <a
              href={link.url}
              class="text-emerald-600 dark:text-emerald-400 hover:underline"
            >
              {link.text}
            </a>
            {index < footerContent.legalLinks.length - 1 && <span class="text-gray-400">‚Ä¢</span>}
          </>
        ))}
      </div>

      <!-- Copyright -->
      <div class="text-center text-sm text-gray-500 dark:text-gray-400 pt-4">
        ¬© {footerContent.copyright.year} {footerContent.copyright.entity}
      </div>
    </div>
  </footer>

  <!-- Category filter and dark mode toggle script -->
  <script is:inline>
    window.addEventListener('load', function() {
      // Category filters
      const filterButtons = document.querySelectorAll('.category-filter');
      const postCards = document.querySelectorAll('.blog-post-card');

      filterButtons.forEach(function(button) {
        button.addEventListener('click', function() {
          const category = button.dataset.category;

          // Update button states
          filterButtons.forEach(function(btn) {
            btn.classList.remove('bg-emerald-100', 'dark:bg-emerald-900/30', 'text-emerald-700', 'dark:text-emerald-400');
            btn.classList.add('bg-gray-100', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-700');
            btn.setAttribute('aria-pressed', 'false');
          });

          button.classList.remove('bg-gray-100', 'dark:bg-gray-800', 'text-gray-700', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-700');
          button.classList.add('bg-emerald-100', 'dark:bg-emerald-900/30', 'text-emerald-700', 'dark:text-emerald-400');
          button.setAttribute('aria-pressed', 'true');

          // Filter posts
          var visibleCount = 0;
          postCards.forEach(function(card) {
            if (category === 'All' || card.dataset.category === category) {
              card.style.display = 'block';
              visibleCount++;
            } else {
              card.style.display = 'none';
            }
          });

          // Announce filter change to screen readers
          var announcement = document.getElementById('filter-announcement');
          if (announcement) {
            var message = category === 'All'
              ? 'Showing all ' + visibleCount + ' articles'
              : 'Showing ' + visibleCount + ' ' + category.toLowerCase() + ' articles';
            announcement.textContent = message;
          }
        });
      });

    });
  </script>
</body>
</html>
